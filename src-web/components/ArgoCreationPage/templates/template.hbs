{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Application ============================ }}
{{! ========================================================== }}
{{! ========================================================== }}
                         

apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: {{{appSetName}}}
spec:
  generators:
    - clusterDecisionResource:
        configMapRef: acm-placement
        name: {{{decisionResourceName}}}                  
        requeueAfterSeconds: {{{requeueTime}}}
  template:
    metadata:
      name: {{{appSetName}}}
    spec:
      project: "default"
      source:

      
{{#each channels}}

{{#switch channelType}}

{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Github channel ========================= }}
{{! ========================================================== }}
{{! ========================================================== }}
{{#case 'github'}}

{{>templateGit 
  githubURL=../../githubURL
  githubPath=../../githubPath
  gitRevision=../../gitRevision
}}
{{/case}}


{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Helm channel ========================= }}
{{! ========================================================== }}
{{! ========================================================== }}
{{#case 'helmrepo'}}

{{>templateHelm 
  helmURL=../../helmURL
  helmChartName=../../helmChartName
  helmPackageVersion=../../helmPackageVersion
}}
{{/case}}


{{/switch}}
{{/each}}
      destination:
        name: '{{clusterName}}'
        namespace: {{{destinationNS}}}

{{! ========================================================== }}
{{! ========================================================== }}
{{! ==================Sync policies ========================= }}
{{! ========================================================== }}
{{! ========================================================== }}      

      syncPolicy:
        automated:
        {{#if prune}}
          prune: true
        {{/if}}
        {{#if allowEmpty}}
          allowEmpty: true
        {{/if}}
        {{#if selfHeal}}
          selfHeal: true
        {{/if}}
        syncOptions:
          {{#if validate}}
            - Validate=true
          {{/if}}
          {{#if pruneLast}}
            - PruneLast=true
          {{/if}}
          {{#if replace}}
            - Replace=true
          {{/if}}
          {{#if createNamespace}}
            - CreateNamespace=true
          {{/if}}
          {{#if applyOutOfSyncOnly}}
            - ApplyOutOfSyncOnly=true
          {{/if}}
          {{#if prunePropagationPolicy}}
            {{#if propagationPolicy}}
            - PrunePropagationPolicy={{{propagationPolicy}}}
            {{/if}}
          {{/if}}

